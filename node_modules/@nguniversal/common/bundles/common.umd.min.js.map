{"version":3,"sources":["modules/common/common.umd.js"],"names":["global","factory","exports","module","require","define","amd","npm_package","ng","common","http","core","platformBrowser","Rx","operators","this","rxjs","TransferHttpCacheInterceptor","appRef","transferState","_this","isCacheActive","isStable","pipe","filter","take","toPromise","then","prototype","invalidateCacheEntry","url","remove","makeStateKey","intercept","req","next","method","handle","storeKey","hasKey","response","get","of","HttpResponse","body","headers","HttpHeaders","status","statusText","tap","event","set","getHeadersMap","e_1","_c","headersMap","_a","o","m","Symbol","iterator","i","call","length","value","done","__values","keys","_b","key","getAll","e_1_1","error","return","decorators","type","Injectable","ctorParameters","ApplicationRef","TransferState","TransferHttpCacheModule","NgModule","args","imports","BrowserTransferStateModule","providers","provide","HTTP_INTERCEPTORS","useExisting","multi","domContentLoadedFactory","doc","Promise","resolve","_reject","contentLoaded","removeEventListener","addEventListener","StateTransferInitializerModule","APP_INITIALIZER","useFactory","deps","DOCUMENT","ɵnguniversal_modules_common_common_b","ɵnguniversal_modules_common_common_a","Object","defineProperty"],"mappings":"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","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/common/http'), require('@angular/core'), require('@angular/platform-browser'), require('rxjs'), require('rxjs/operators'), require('@angular/common')) :\n\ttypeof define === 'function' && define.amd ? define(['exports', '@angular/common/http', '@angular/core', '@angular/platform-browser', 'rxjs', 'rxjs/operators', '@angular/common'], factory) :\n\t(factory((global.npm_package = {}),global.ng.common.http,global.ng.core,global.ng.platformBrowser,global.Rx,global.Rx.operators,global.ng.common));\n}(this, (function (exports,http,core,platformBrowser,rxjs,operators,common) { 'use strict';\n\nvar __values = (undefined && undefined.__values) || function (o) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\n    if (m) return m.call(o);\n    return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n};\nfunction getHeadersMap(headers) {\n    var headersMap = {};\n    try {\n        for (var _a = __values(headers.keys()), _b = _a.next(); !_b.done; _b = _a.next()) {\n            var key = _b.value;\n            headersMap[key] = (headers.getAll(key));\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_b && !_b.done && (_c = _a.return)) _c.call(_a);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return headersMap;\n    var e_1, _c;\n}\nvar TransferHttpCacheInterceptor = /** @class */ (function () {\n    function TransferHttpCacheInterceptor(appRef, transferState) {\n        var _this = this;\n        this.transferState = transferState;\n        this.isCacheActive = true;\n        // Stop using the cache if the application has stabilized, indicating initial rendering is\n        // complete.\n        appRef.isStable\n            .pipe(operators.filter(function (isStable) { return isStable; }), operators.take(1)).toPromise()\n            .then(function () { _this.isCacheActive = false; });\n    }\n    TransferHttpCacheInterceptor.prototype.invalidateCacheEntry = function (url) {\n        this.transferState.remove(platformBrowser.makeStateKey('G.' + url));\n        this.transferState.remove(platformBrowser.makeStateKey('H.' + url));\n    };\n    TransferHttpCacheInterceptor.prototype.intercept = function (req, next) {\n        var _this = this;\n        // Stop using the cache if there is a mutating call.\n        if (req.method !== 'GET' && req.method !== 'HEAD') {\n            this.isCacheActive = false;\n            this.invalidateCacheEntry(req.url);\n        }\n        if (!this.isCacheActive) {\n            // Cache is no longer active. Pass the request through.\n            return next.handle(req);\n        }\n        var key = (req.method === 'GET' ? 'G.' : 'H.') + req.url;\n        var storeKey = platformBrowser.makeStateKey(key);\n        if (this.transferState.hasKey(storeKey)) {\n            // Request found in cache. Respond using it.\n            var response = this.transferState.get(storeKey, {});\n            return rxjs.of(new http.HttpResponse({\n                body: response.body,\n                headers: new http.HttpHeaders(response.headers),\n                status: response.status,\n                statusText: response.statusText,\n                url: response.url,\n            }));\n        }\n        else {\n            // Request not found in cache. Make the request and cache it.\n            var httpEvent = next.handle(req);\n            return httpEvent\n                .pipe(operators.tap(function (event) {\n                if (event instanceof http.HttpResponse) {\n                    _this.transferState.set(storeKey, {\n                        body: event.body,\n                        headers: getHeadersMap(event.headers),\n                        status: event.status,\n                        statusText: event.statusText,\n                        url: (event.url),\n                    });\n                }\n            }));\n        }\n    };\n    TransferHttpCacheInterceptor.decorators = [\n        { type: core.Injectable }\n    ];\n    /** @nocollapse */\n    TransferHttpCacheInterceptor.ctorParameters = function () { return [\n        { type: core.ApplicationRef, },\n        { type: platformBrowser.TransferState, },\n    ]; };\n    return TransferHttpCacheInterceptor;\n}());\n/**\n * An NgModule used in conjunction with `ServerTransferHttpCacheModule` to transfer cached HTTP\n * calls from the server to the client application.\n */\nvar TransferHttpCacheModule = /** @class */ (function () {\n    function TransferHttpCacheModule() {\n    }\n    TransferHttpCacheModule.decorators = [\n        { type: core.NgModule, args: [{\n                    imports: [platformBrowser.BrowserTransferStateModule],\n                    providers: [\n                        TransferHttpCacheInterceptor,\n                        { provide: http.HTTP_INTERCEPTORS, useExisting: TransferHttpCacheInterceptor, multi: true },\n                    ],\n                },] }\n    ];\n    return TransferHttpCacheModule;\n}());\n\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nfunction domContentLoadedFactory(doc) {\n    return function () {\n        return new Promise(function (resolve, _reject) {\n            var contentLoaded = function () {\n                doc.removeEventListener('DOMContentLoaded', contentLoaded);\n                resolve();\n            };\n            doc.addEventListener('DOMContentLoaded', contentLoaded);\n        });\n    };\n}\nvar StateTransferInitializerModule = /** @class */ (function () {\n    function StateTransferInitializerModule() {\n    }\n    StateTransferInitializerModule.decorators = [\n        { type: core.NgModule, args: [{\n                    providers: [\n                        { provide: core.APP_INITIALIZER, multi: true, useFactory: domContentLoadedFactory, deps: [common.DOCUMENT] },\n                    ]\n                },] }\n    ];\n    return StateTransferInitializerModule;\n}());\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexports.ɵnguniversal_modules_common_common_b = domContentLoadedFactory;\nexports.ɵnguniversal_modules_common_common_a = TransferHttpCacheInterceptor;\nexports.TransferHttpCacheModule = TransferHttpCacheModule;\nexports.StateTransferInitializerModule = StateTransferInitializerModule;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=common.umd.js.map\n"]}